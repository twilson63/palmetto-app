var app = require('vbridge');

module.exports = function(o) {
  var ee = o.flow;
  var state = app.state(o.state);
  // load services
  o.services.forEach(function(s) {
    s(ee);
  });

  var components = {};

  o.components.forEach(function(c) {
      c(state, ee);
      components[c.ref] = c.render;
    });

  // init router
  o.routes(require('page'), ee);
  require('page')();
  require('page-body-parser')();

  app(document.body, state, o.render(components));
}
